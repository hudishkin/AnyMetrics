# AnyMetrics | [EN](README.md)

**Превратите любой API или сайт в виджет на домашнем экране.**

AnyMetrics позволяет отправлять запросы к любым HTTP-эндпоинтам — REST API, JSON-сервисам или веб-страницам — и выводить данные прямо на виджет iPhone. Без программирования.

![Preview](preview.png)

## Возможности

- **Произвольные HTTP-запросы** — любой метод, кастомные заголовки, настраиваемый таймаут
- **Парсинг JSON** — мощные правила с фильтрами, агрегатами и селекторами
- **Парсинг HTML** — извлечение текста из веб-страниц через CSS-селекторы
- **Мониторинг HTTP-статуса** — проверка доступности эндпоинта (2xx = ОК)
- **Виджеты на домашнем экране** — отображение данных в компактных WidgetKit-виджетах
- **Форматирование значений** — валюта, обрезка длины и другое
- **Галерея** — готовые метрики, добавление в одно нажатие
- **Импорт / Экспорт** — обмен метриками в формате JSON
- **Локализация** — английский и русский
- **Бесплатно, без рекламы, без подписки, open source**

## Примеры использования

- Мониторинг доступности серверов и API
- Статистика CI/CD из GitHub, GitLab или Jenkins
- Время отклика, процент ошибок, данные любого эндпоинта
- Статус деплоя и здоровье сервисов
- Количество загрузок, звёзды репозиториев, метрики использования

## Правила парсинга

### JSON

Навигация по JSON через путь, разделённый точками.

#### Базовая навигация

``` json
{
  "data": {
    "items": ["apple", "google", "facebook"]
  }
}
```

| Правило | Результат | Описание |
|---|---|---|
| `data.items.1` | `google` | Доступ к элементу массива по индексу |
| `data.items.0` | `apple` | Первый элемент |

#### Агрегатные операции

Применяются ко всем элементам массива.

``` json
{
  "users": [
    { "name": "Alice", "age": 25 },
    { "name": "Bob", "age": 30 },
    { "name": "Charlie", "age": 35 }
  ]
}
```

| Оператор | Описание | Пример | Результат |
|---|---|---|---|
| `*+` | Сумма | `users.*+.age` | `90` |
| `*avg` | Среднее | `users.*avg.age` | `30` |
| `*min` | Минимум | `users.*min.age` | `25` |
| `*max` | Максимум | `users.*max.age` | `35` |

#### Селекторы элементов

| Оператор | Описание | Пример | Результат |
|---|---|---|---|
| `*first` | Первый элемент | `users.*first.name` | `Alice` |
| `*last` | Последний элемент | `users.*last.name` | `Charlie` |
| `*count` | Количество элементов | `users.*count` | `3` |

#### Фильтры

Фильтрация элементов массива перед применением операций. Синтаксис: `*[поле<оператор>значение]`

``` json
{
  "servers": [
    { "name": "s1", "status": "online", "cpu": 45 },
    { "name": "s2", "status": "offline", "cpu": 90 },
    { "name": "s3", "status": "online", "cpu": 72 }
  ]
}
```

| Оператор | Описание | Пример | Результат |
|---|---|---|---|
| `=` | Равно | `servers.*[status=online].*count` | `2` |
| `!=` | Не равно | `servers.*[status!=offline].*count` | `2` |
| `>` | Больше | `servers.*[cpu>50].*count` | `2` |
| `<` | Меньше | `servers.*[cpu<80].*+.cpu` | `117` |
| `>=` | Больше или равно | `servers.*[cpu>=72].*avg.cpu` | `81` |
| `<=` | Меньше или равно | `servers.*[cpu<=45].*first.name` | `s1` |

#### Комбинирование операций

Фильтры, селекторы и агрегаты можно комбинировать:

- `servers.*[status=online].*avg.cpu` — средний CPU онлайн-серверов → `58`
- `servers.*[cpu>50].*last.name` — имя последнего сервера с cpu > 50 → `s3`
- `servers.*[status=online].*max.cpu` — максимальный CPU среди онлайн → `72`

### HTML

Используется формат как при `Document.querySelector(selector)`

Пример: `div a.link`

## Требования

- iOS 15.0+
- Xcode 15+
- [Tuist](https://tuist.io)

## Начало работы

```bash
tuist install
tuist generate
```

## Ссылки

- [Репозиторий галереи](https://github.com/hudishkin/AnyMetricsGallery) — метрики от сообщества
- [App Store](https://apps.apple.com/us/app/anymetrics/id1609900961)

## Лицензия

Open source.

______

[![AppStore](appstore.png)](https://apps.apple.com/us/app/anymetrics/id1609900961)
